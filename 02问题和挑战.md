## 2. 问题和挑战

- 在这里我们介绍我们所处理的威胁模型、系统所操作的日志数据，以及在设计和评估Beehive时遇到的挑战。

### 2.1 威胁模型

- Beehive旨在检测发生在两种不同情景下的威胁。第一种情景涉及一个被感染的网络主机或面临感染风险的网络主机。在这种情况下的主机可能会展现出恶意或危险的行为比如：连接一个攻击网站，与C&C服务器通信，或者将数据泄露给一个之前从未被识别的外部目的地。这些行为可能是由以下原因导致的：恶意软件的自动活动（例如：僵尸网络中的僵尸机器），攻击者对主机的直接控制（通过远程访问木马），或者是善良的用户被危险行为所欺骗（例如：通过网络钓鱼攻击）。

- 第二种情景涉及到违反企业策略的基于主机的用户活动。这些活动的目的并不一定是恶意的，但可能对业务会造成损害，因此也是不被希望的。例子包括对等的文件共享，即时通讯，多媒体流媒体，成人内容查看，在线游戏以及使用代理和隧道服务试图去翻过企业防火墙或者其他网络周边安全机制。

### 2.2 数据

- Beehive使用不同网络设备所产生的大范围日志，包括记录每个出站连接的网络代理，用来动态分配IP地址的DHCP服务器，记录与企业网络远程连接的VPN服务器，**Windows域控制器在合**，以及能够记录在中断进行的恶意扫描结果的抗病毒软件。这些日志被存储在一个商业安全信息和事件管理（SIEM）系统中。

- 除了web代理之外，所有的设备都透明地监视并且记录企业主机的活动，对每一个外部目的地，web代理器都会查询由产品供应商维护的域的声誉得分和站点类别列表，如果目的地的声誉分数过低或者属于禁用类别（例如：成人内容网站），web代理就会自动阻止连接。然而，如果目的地并不在列表中，web代理会向用户显示一个警告页面，这个页面描述了连接一个未知站点的潜在风险。用户必须显示点击这个链接以确认同意公司的网络策略，否则不访问该站点。

- Beehive大量使用web代理日志，因为在企业中的大部分网络活动都是通过是HTTP或者HTTPS来进行的。除此之外，这些日志包含了HTTP头部的所有字段，使他们成为了了解用户浏览行为、检测可疑连接和分析的特别有用的资源  。表1列出了web代理日志中包含的字段的一部分。

| IP报头   |                                              源/目的IP和端口 |
| -------- | -----------------------------------------------------------: |
| 传输报头 | 目的地域，URL，HTTP状态码，web引用，域声誉，域类别，用户代理字符串 |
| 连接属性 |                                     发送和接受字节，网络策略 |

表1：web代理日志中的字段

- 在EMC，平均每天产生14亿条日志消息，其速率大约为1TB每天。这些“原始”日志包含大量有关用户和主机行为的信息。它们也是由噪声的——有非标准化的时间戳、不同的标识符（即：其中一些存储主机的IP地址，一些存储的是主机名，另一些存储用户名——并且可以被阶段或不按顺序到达。在接下来的一部分，我们将讨论分析此类“大数据”所面临的挑战。

### 2.3 挑战

- 在真实企业网络中观察到的大量事件以及在SIEM系统中登录的大量事件数量太大，对安全事件的日志分析和检测构成了重大挑战（“大数据“问题）。如上所述，在我们的案例研究中，SIEM平均每天收集14亿日志。因此，通过Beehive及时检测关键威胁需要高效的数据约简算法和策略来关注日志中与安全相关的信息
- Beehive面临的第二个挑战是：在SIEM系统收集的日志和安全分析学家识别可疑主机行为所需的信息之间存在显著语义差异的情况下，识别有意义安全事件。在我们的案例中，Beehive需要生成可疑主机的每日报告；然而，大多数的网络设备只记录了网络端点的IP地址。当IP地址在网络中被动态分配时，将IP地址与特定的主机关联需要找到不同日志的相关性（correlation），这一点是非常具有挑战性的。由于登录设备可能位于不同的时区（这是全球组织的基础设施的典型情况）因此，它们生成的时间戳必须被标准化以便精准获时间相关性，这就使得情况更加复杂。

- 最后，在设计Beehive的一个主要挑战是难以准确评估其有效性，由于缺乏固有的衡量标准（ground truth）。具体来说，企业网络通常在网络外围和主机上都部署了最先进的安全技术，同时安全分析人员积极地解决已知的事件。于是导致了这样的一个结果，从这样一个网络获得的真实网络数据往往缺乏已知安全威胁的踪迹。比如，主机的恶意软件在激活（active）前常常被清除或隔离（quarantine），面对僵尸网络（botnet）C&C服务器的访问通常会被防火墙阻止。这种威胁解决方案阻止了Beehive对已知恶意流量的真实性检测，因为没有证据能够证明存在恶意网络流量。许多被Beehive识别的事件实际上是企业中所用的安全系统不知道的。因此我们必须依赖于对安全事件和被Beehive检测到的可疑主机的人工评估。
- 在设计Beehive的过程中，我们探索并解决了由于大数据安全分析带来的挑战，简单来说，在一个预处理阶段，Beehive标准化了所有日志条目的时间戳到**UTC**（世界标准时间），确定了被静态或动态分配的IP地址，并构造主机和IP地址之间的绑定，从而将每个日志事件归属到特定的主机。然后Beehive为单个主机提取特定企业的特性，并对具有类似可疑行为的主机进行集群（cluster）。由此产生的外围集群将作为事件提交给安全分析人员进行检查。
- 在本次研究中，为了评定Beehive的有效性，我们在自己企业安全运营中心（SOC）的帮助下，手工调查了现有被记录的事件。鉴于已知签名攻击的现有企业解决方案，我们的研究中特别感兴趣的部分是Beehive对用户违反网络策略行为的识别以及当前基于签名的工具没有检测到的恶意软件。



