# 4.评价

- 从2013年4月22日到5月5日，我们在一个大的企业EMC中进行了为期两周的评估。在这期间，**Beehive**产生了784个事件，平均每天56个，标准差是6.88。在这些事件中，只有8个事件与企业最先进的安全工具生成的警报重叠了。
- 为了在缺乏地面真相的情况下对蜂巢进行评估——在准确的意义上，现有的对已识别事件的分类——我们采用手工调查的两步过程。我们首先检查并标记由Beehive产生的所有事件(参见4.2节)。无法识别原因的事件被标记为“可疑”，并提交给企业安全运营中心(SOC)进行进一步分析(见4.3节)。
- 为了在没有==标准答案==的情况下衡量**Beehive** —— 在准确的意义上，现有的对已知识别事件的分类——我们采用了手工调查的两步方法。我们首先对**Beehive**产生的所有事件进行检查并标注（见4.2节）。无法识别原因的事件就被标注为“可疑”，并且被提交给企业安全运营中心（SOC）来进行进一步的分析（见4.3节）。

## 4.1 聚类的环境

- 除了主机和它的特征向量外，每一个**Beehive**事件也包括每台主机所属集群的背景信息，比如一个集群中的主机数量和特征向量因子的平均值。这些信息有助于下面描述的手动调查过程，因为它允许分析者快速识别每个集群中的不同特性。

- 为了直观地了解集群捕获的活动类型，图4显示了4月24日生成的所有15个外围集群的归一化平均特征向量。也就是说，我们首先根据一个聚类中的所有向量的平均值计算出每个聚类的均值特征向量，接着再对每个向量分量进行表转化。特征值-相对于所有平均特征向量的最大值。如图4所示，集群的不同之处在于它们具有不同(子集)的特征。
- 为了直观地了解集群捕获的活动类型，图4显示了4月24日生成的所有15个外围集群（**outlying cluster**）的归一化（**normalized**）平均特征向量。也就是说，**我们首先计算每个簇的平均特征向量除以该簇中所有向量的平均值，**然后对每个向量分量进行归一化。，特征值-相对于所有平均特征向量的最大值。如图4所示，集群的不同之处在于它们具有不同(子集)的特征。
- 虽然集群彼此之间不同，但在同一集群下的主机展现出十分相似的行为。表3展示了  4月24日的两个示例集群（3和6）中主机的实际特征向量。举个例子，集群3的独特之处在于它有大量的阻塞连接、连接尖峰和域尖峰——这表明活动是由自动化进程负责的。（事实上，在我们下一小节要讲述的调查中，集群中的主机被发现通过多次强制连接阻塞域而违反公司政策）。另一个例子，集群6中的主机有大量与新目的地的连接，同样有与阻塞域和挑战域的连接高峰。我们的调查显示这个集群是由连接静态域的感染主机单独组成的（DGAs）
- 接下来，我们会详细介绍手工调查方法和由**Beehive**检测的可疑行为。

- to give intuition about...为了直观的...

## 4.2 手动标记

- 我们对一个主机的手动调查过程是通过识别主机所在集群的特有的特性开始。然后，我们尝试使用**Beehive**报告的上下文信息和检查SIEM系统收集的主机原始日志来识别这种差异的根源。后者涉及到查找来自主机的连接中的UA字符串，HTTP状态码，web引用程序和计时模式，以及已连接域的信誉（使用McAfee SiteAdvisor and URLvoid），以及什么时候被注册的（使用DomainTools）

- 简单地说，25.25%的蜂巢事件是确认的恶意软件或“可疑”(我们在4.3节中给出了更多关于“可疑”事件的细节)，39.41%的事件是违反企业安全策略的，35.33%的事件与未识别(但有噪声)的软件或服务有关。表4列出每一类事件的数目和百分比。

- 简要来说，**Beehive**事件中25.25%要么是被确认的恶意软件，要么是“可疑的”（我们会在4.3节中给出更多的关于“可疑”事件的详细介绍），39.41%是违反企业策略的，还有35.33%的事件与未被识别（但有噪声）的软件或服务有关。表4列出了每类事件的数量和所占百分比。

  | 类别                                                         |                                               数量 |                                                       百分比 |
  | :----------------------------------------------------------- | -------------------------------------------------: | -----------------------------------------------------------: |
  | 恶意软件                                                     |                                                117 |                                                       14.92% |
  | 可疑的                                                       |                                                 81 |                                                       10.33% |
  | 策略违反——隧道技术<br>策略违反——文件分享<br>策略违反——流<br>策略违反——IM<br>策略违反——色情<br>策略违反——赌博<br>策略违反——代理<br>策略违反——远程访问<br>策略违反——封禁网站<br> | 1<br>2<br>86<br>56<br>6<br>13<br>4<br>8<br>133<br> | 0.12%<br>0.25%<br>10.96%<br>7.14%<br/>0.76%<br/>1.65%<br/>0.51<br/>1.02<br/>16.96<br/> |
  | 其他——未被分类的网站<br/>其他——浏览<br/>其他——自动           |                                  57<br/>63<br/>157 |                                   7.27%<br/>8.03%<br/>20.02% |

  **表4：从2013年4月22日到5月5日间，超过两周时间内Beehive事件的分类分解**

- **Beehive**检测到的许多恶意软件都是通过域生成算法(DGAs)创建的域联系(或试图联系)的。基于目的地的特性(见3.2节)在识别此类恶意软件方面被证明是最有用的，因为大多数DGA主机都位于具有大量新目的地的集群中。在图4所示的4月24日以后的集群中，集群1、集群6、集群8中的所有主机都被确认感染了DGA恶意软件。这些感染以前都没有被杀毒软件或企业SOC检测到。

- **Beehive**还检测到对企业网络安全策略的违反。与许多公司一样，这些规定禁止个人大量使用公司计算资源、安装未经公司明确批准的软件、访问具有攻击性的材料(例如色情或其他贬损性的内容)，以及出于商业目的而不当地大量消耗带宽。我们的人工调查发现，16.96%与外部目的地有着高流量的相关事件由于业务原因或被标记为潜在不安全(例如与免费软件相关的站点)而被阻塞。10.96%的事件是由高容量视频流应用程序引起的，通常以连接或域峰值或大量有问题的连接为特征。其他包括文件共享、第三方即时消息、在线赌博、查看成人内容，或者使用隧道或代理服务绕过网络安全机制(例如，访问被屏蔽的网站)。

  **图4:2013年4月24日生成的聚类的归一化平均特征向量**

  **表3:两个示例集群中主机的特征向量。每一行对应于集群中主机的特征向量。最后一行显示了2013年4月24日所有集群中每个特性的最大值。**

- 除了恶意软件和策略违反外，**Beehive**还检测到来自可能是良性的、但未被识别的、可能是自动应用程序的异常活动。例如，20.02%的事件涉及每天连接同一网站成千上万次的主机。这些站点通常是新闻、体育或金融站点，但包括广告服务器、在线论坛和位于谷歌应用程序引擎上的站点。几个主机被发现在挖掘比特币。我们将这些主机都标记为”其他——自动化“。

- 最终，8.03%的事件要么有着高数量（每天上千）的*同意*连接，表明用户在开始访问站点之前，已经明确承认了公司的网络政策，要么对不同域的有较长时间（即持续数小时）的持续网络流量。由于没有恶意行为的进一步证据，我们将这些事件归类到“其他-浏览”的类别，尽管他们可能并非完全受用户驱动。

## 4.3 SOC的调查

- 4.2节所提到的第一轮手工标签方法产生了81个事件（10.33%），我们无法识别对事件中观察到的而行为负责的应用程序。这些事件中的主机与有着较低信誉的网站相连（比如：由反病毒供应商标记，在过去的六个月注册，使用类似于DGA的子域名），下载的可执行文件或压缩文件、使用格式错误的HTTP用户代理字符串，或以半正则（semi-regular）间隔重复连接相同的URL。
- 我们将这些事件标记位“可疑的”，并且把它们交给企业的SOC来做第二轮的分析。表5展示了SOC分配给这些事件的标签。
- 尽管54.32%的“可疑事件被SOC确认为广告程序，间谍软件，或已知的恶意软件，重要的一部分（32.09%）被视作是严肃的事件并且值得进一步的调查。这些可疑的活动可能是以前未知的潜在恶意软件或其他对最先进的安全工具不透明的威胁，需要主机的深入检查来确定确切的根本原因。
- 一小部分被调查的“可疑的”事件被识别为政策违反（4.93%）或者未被分类的网站（8.64%）。它们与不知名软件或低声誉网站的联系，促使其在第一轮调查时被划分为了可疑的。

## 4.4 总结

- 在企业SOC的帮助下，我们手工调查了两周期间内784个**Beehive**事件。总得来说，我们发现了25.25%的事件与恶意软件有关，或者需要SOC更进一步的调查，39.42%属于政策违反，35.33%与未被识别，但自动的软件或服务有关。784个事件中仅有8个（1.02%）是已经被现有最先进的安全工具所检测到了的，这表明通过识别先前未知的异常行为能够证明**Beehive**的性能。